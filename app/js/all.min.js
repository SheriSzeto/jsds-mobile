!function(){"use strict";document.addEventListener("DOMContentLoaded",function(){var t=document.documentElement,e=t.clientWidth;t.style.fontSize=e/7.2+"px",console.log(t.style.fontSize)},!1)}();
"use strict";var app=angular.module("app",["ui.router","ngDialog"]);app.run(["$rootScope","$state","$stateParams",function(t,r,e){t.$state=r,t.$stateParams=e}]),app.config(["$stateProvider","$urlRouterProvider",function(t,r){r.otherwise("/product"),t.state("/product",{url:"/product",templateUrl:"pages/product/product.html"}).state("/cart",{url:"/cart",templateUrl:"pages/cart/cart.html"}).state("/user",{url:"/user",templateUrl:"pages/user/user.html"}).state("/booking",{url:"/booking",templateUrl:"pages/booking/booking.html"}).state("/orders",{url:"/orders",templateUrl:"pages/orders/orders.html"})}]);
app.factory("$common",["$q","$rootScope",function(e,t){t.selectProducts=[];var a={};a.getMenu=[{name:"服务项目",img:"project",path:"/product",active:!0},{name:"购物车",img:"cart",path:"/cart",active:!1},{name:"我的订单",img:"myorder",path:"/user",active:!1}],a.technicianGender=[{val:0,text:"男技师",active:"false"},{val:2,text:"不限",active:"true"},{val:1,text:"女技师",active:"false"}],a.getGPSPosition=function(){var t=e.defer(),a=new BMap.Geolocation,r=new BMap.Geocoder;return a.getCurrentPosition(function(e){this.getStatus()==BMAP_STATUS_SUCCESS?r.getLocation(e.point,function(e){var a=e.addressComponents,r=a.district+a.street;t.resolve(r)}):alert("failed"+this.getStatus())},{enableHighAccuracy:!0}),t.promise};var r;a.createCode=function(){r="";for(var e=new Array(0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"),t=0;t<4;t++){var a=Math.floor(52*Math.random());r+=e[a]}return r};var n=[];return a.getDays=function(e,t,a){"number"==typeof e&&(a=t,t=e,e=new Date);for(var r=new Date(e),o=0;o<=t;o++){var c=null;if(a)c=parseInt(r.getMonth()+1)<10?r.getDate()<10?"0"+parseInt(r.getMonth()+1)+"月0"+r.getDate()+"日":"0"+parseInt(r.getMonth()+1)+"月"+r.getDate()+"日":r.getDate()<10?parseInt(r.getMonth()+1)+"月0"+r.getDate()+"日":parseInt(r.getMonth()+1)+"月"+r.getDate()+"日";else{var i=a;i=i.replace(/y{4}/,r.getFullYear()),i=i.replace(/M{2}/,r.getMonth()+1),i=i.replace(/d{2}/,r.getDate()),c=i}n.push(c),r.setDate(r.getDate()+1)}return n},a.get24Hours=function(){var e=[],t=(new Date).getHours(),a=(new Date).getSeconds();console.log(t+a);for(var r=0;r<24;r++){var n=r<10?"0"+r+":00":r+":00";e.push(n)}return e},a}]);
app.controller("indexCtrl",["$scope","$state","$common",function(e,t,n){e.menus=n.getMenu,e.route=function(n){e.menus.forEach(function(e){e.active=!1}),n.active=!0,"我的订单"==n.name&&(n.path=sessionStorage.getItem("username")?"/orders":n.path),t.go(n.path)}}]);
app.controller("cartCtrl",["$scope","$state","$common","$http","ngDialog","$rootScope",function(e,t,o,n,r,c){e.form={},e.userMsg?(e.isExistServeMsg=!0,e.form=e.userMsg):e.isExistServeMsg=!1,e.technicianGender=o.technicianGender,e.form.technicianGender=2,e.$watch("selectProducts",function(t){t&&t.length>0&&(e.totalprice=0,t.forEach(function(t){e.totalprice+=t.newprice}))}),e.setMsg=function(){t.go("/booking")},e.selectTechnicianGender=function(t){e.technicianGender.forEach(function(e){e.active=!1}),t.active=!0,e.form.technicianGender=t.val},e.clearCart=function(){c.selectProducts=[]},e.pay=function(){e.form.orderMsg=e.selectProducts,e.form.totalprice=e.totalprice,e.form.phone?n.post("/submitOrder",{phone:e.form.phone,orders:e.form}).then(function(e){e.data.success&&(c.orderMsg=e.data.result,t.go("/orders"))}):r.open({template:"<p>请先填写用户信息</p>",plain:!0})}}]);
app.controller("bookingCtrl",["$scope","$common","$http","ngDialog","$state","$rootScope",function(e,r,a,o,t,s){var l,n;s.userMsg?(n=!0,e.form=s.userMsg):(e.form={},n=!1),e.gender=e.form.gender=0,e.hasRead=!0,e.initTime=function(){var e=[[{values:r.getDays(30,"yyyy年MM月dd日"),label:"服务日期"}],[{values:r.get24Hours(),label:"服务时间"}]],a=e[0][0].values[0],o=e[1][0].values[0];console.log(a+","+o),l=a+" "+o,$("#orderTime").mobiscroll().scroller({theme:"mobiscroll",display:"inline",lang:"zh",showLabel:!0,rows:1,wheels:e,defaultValue:[a,o]})},e.getSex=function(r){e.gender=e.form.gender=r},e.saveUserMsg=function(r){var i=$("#orderTime").val();0==Boolean(i)&&(i=l);var g=i.split(" ")[0].replace(/月/,"-").replace(/日/,"");e.form.ordertime=g.substring(0,2)<(new Date).getMonth()+1?Date.parse((new Date).getFullYear()+1+"-"+g+" "+i.split(" ")[1]+":00"):Date.parse((new Date).getFullYear()+"-"+g+" "+i.split(" ")[1]+":00"),console.log(e.form.ordertime),r&&(n?a.post("/updateUserMsg",e.form).then(function(e){e.data.success?(s.userMsg=e.data.result,t.go("/cart")):o.open({template:"<p>"+e.data.errormsg+"</p>",plain:!0})}):a.post("/saveUserMsg",e.form).then(function(e){e.data.success?(s.userMsg=e.data.result,t.go("/cart")):o.open({template:"<p>"+e.data.errormsg+"</p>",plain:!0})}))},e.initTime()}]);
app.controller("orderCtrl",["$scope","ngDialog","$http","$filter",function(r,e,t,o){if(r.userPhone)t.post("/queryOrders",{phone:r.userPhone}).then(function(e){e.data.success&&(e.data.result.length>0?(r.orderList=[],e.data.result.forEach(function(e){for(var t=o("date")(e.ordertime,"yyyy-MM-dd HH:mm:ss").split(" "),s=0,d=0;d<e.orderMsg.length;d++)s+=e.orderMsg[d].period;r.orderList.push({name:"李师傅",orderdate:t[0],period:t[1].substring(0,2)+":00-"+(Number(t[1].substring(0,2))+s/60)+":00",totalprice:e.totalprice,orderstate:0})})):r.orderList=[])});else if(r.orderMsg){r.orderList=[];for(var s=o("date")(r.orderMsg.ordertime,"yyyy-MM-dd HH:mm:ss").split(" "),d=0,a=0;a<r.orderMsg.orderMsg.length;a++)d+=r.orderMsg.orderMsg[a].period;r.orderList.push({name:"李师傅",orderdate:s[0],period:s[1].substring(0,2)+":00-"+(Number(s[1].substring(0,2))+d/60)+":00",totalprice:r.orderMsg.totalprice,orderstate:0})}console.log(r.orderList),r.contact=function(){e.open({template:"contact.html",className:"ngdialog-theme-default ngdialog-theme-dadao"})}}]);
app.controller("productCtrl",["$scope","$common","$http",function(t,e,n){t.getProducts=function(){n.get("/getProduct").then(function(e){if(t.selectProducts.length>0)for(var n=0;n<t.selectProducts.length;n++)e.data.find(function(o,i){o._id==t.selectProducts[n]._id&&(e.data[i].disabled=!0)});console.log(e.data),t.products=e.data})},t.currentPosition="正在定位...",e.getGPSPosition().then(function(e){t.currentPosition=e}),t.addCart=function(e,n){if(!n.disabled||1!=n.disabled){var o=e.target,i=$(".cart").offset(),c=$(o),d=c.parentsUntil("#main",".projectDetail").find(".pImg").attr("src");$('<img class="u-flyer" src="'+d+'">').fly({start:{left:event.pageX,top:event.pageY},end:{left:i.left+10,top:i.top+10,width:0,height:0},onEnd:function(){n.disabled=!0,t.$apply(n),t.selectProducts.push(n),this.destory()}})}},t.init=function(){t.getProducts()},t.init()}]);
app.controller("userCtrl",["$scope","$common","ngDialog","$state","$http","$rootScope",function(o,e,n,t,r,c){o.form={},o.changeCode=function(){o.code=e.createCode()},o.login=function(e){e&&(o.form.smscode.toLowerCase()==o.code.toLowerCase()?(c.userPhone=o.form.phone,t.go("/orders")):n.open({template:"<p>验证码输入错误!</p>",plain:!0}))},o.changeCode()}]);